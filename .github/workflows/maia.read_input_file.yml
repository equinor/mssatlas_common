name: Callable - Read JSON input parameters

on:
  workflow_call:
    inputs:
      filename:
        description: 'JSON file with input parameters.'
        type: string
        required: true

    outputs:
      dev_subscriptionid:
        value: ${{ jobs.read_json.outputs.dev_subscriptionid }}
      dev_resourcegroup: 
        value: ${{ jobs.read_json.outputs.dev_resourcegroup }}
      dev_datafactory_name: 
        value: ${{ jobs.read_json.outputs.dev_datafactory_name }}
      dev_databricks_kv: 
        value: ${{ jobs.read_json.outputs.dev_databricks_kv }}
      dev_squad_name: 
        value: ${{ jobs.read_json.outputs.dev_squad_name }}

      test_subscriptionid:
        value: ${{ jobs.read_json.outputs.test_subscriptionid }}
      test_resourcegroup: 
        value: ${{ jobs.read_json.outputs.test_resourcegroup }}
      test_datafactory_name: 
        value: ${{ jobs.read_json.outputs.test_datafactory_name }}
      test_databricks_kv: 
        value: ${{ jobs.read_json.outputs.test_databricks_kv }}
      test_squad_name: 
        value: ${{ jobs.read_json.outputs.test_squad_name }}

      qa_subscriptionid:
        value: ${{ jobs.read_json.outputs.qa_subscriptionid }}
      qa_resourcegroup: 
        value: ${{ jobs.read_json.outputs.qa_resourcegroup }}
      qa_datafactory_name: 
        value: ${{ jobs.read_json.outputs.qa_datafactory_name }}
      qa_databricks_kv: 
        value: ${{ jobs.read_json.outputs.qa_databricks_kv }}
      qa_squad_name: 
        value: ${{ jobs.read_json.outputs.qa_squad_name }}

      prod_subscriptionid:
        value: ${{ jobs.read_json.outputs.prod_subscriptionid }}
      prod_resourcegroup: 
        value: ${{ jobs.read_json.outputs.prod_resourcegroup }}
      prod_datafactory_name: 
        value: ${{ jobs.read_json.outputs.prod_datafactory_name }}
      prod_databricks_kv: 
        value: ${{ jobs.read_json.outputs.prod_databricks_kv }}
      prod_squad_name: 
        value: ${{ jobs.read_json.outputs.prod_squad_name }}

jobs:
  read_json:
    runs-on: ubuntu-latest
    outputs:
      dev_subscriptionid: ${{ steps.read_file.outputs.dev_subscriptionid }}
      dev_resourcegroup: ${{ steps.read_file.outputs.dev_resourcegroup }}
      dev_datafactory_name: ${{ steps.read_file.outputs.dev_datafactory_name }}
      dev_databricks_kv: ${{ steps.read_file.outputs.dev_databricks_kv }}
      dev_squad_name: ${{ steps.read_file.outputs.dev_squad_name }}

      test_subscriptionid: ${{ steps.read_file.outputs.test_subscriptionid }}
      test_resourcegroup: ${{ steps.read_file.outputs.test_resourcegroup }}
      test_datafactory_name: ${{ steps.read_file.outputs.test_datafactory_name }}
      test_databricks_kv: ${{ steps.read_file.outputs.test_databricks_kv }}
      test_squad_name: ${{ steps.read_file.outputs.test_squad_name }}

      qa_subscriptionid: ${{ steps.read_file.outputs.qa_subscriptionid }}
      qa_resourcegroup: ${{ steps.read_file.outputs.qa_resourcegroup }}
      qa_datafactory_name: ${{ steps.read_file.outputs.qa_datafactory_name }}
      qa_databricks_kv: ${{ steps.read_file.outputs.qa_databricks_kv }}
      qa_squad_name: ${{ steps.read_file.outputs.qa_squad_name }}

      prod_subscriptionid: ${{ steps.read_file.outputs.prod_subscriptionid }}
      prod_resourcegroup: ${{ steps.read_file.outputs.prod_resourcegroup }}
      prod_datafactory_name: ${{ steps.read_file.outputs.prod_datafactory_name }}
      prod_databricks_kv: ${{ steps.read_file.outputs.prod_databricks_kv }}
      prod_squad_name: ${{ steps.read_file.outputs.prod_squad_name }}

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          ref: main

      - name: Read JSON
        id: read_file
        run: |
          echo ::set-output name=dev_subscriptionid::$(jq -r '.environments.dev.subscriptionid' ${filename})
          echo ::set-output name=dev_resourcegroup::$(jq -r '.environments.dev.resourcegroup' input-file.json)
          echo ::set-output name=dev_datafactory_name::$(jq -r '.environments.dev.datafactory_name' input-file.json)
          echo ::set-output name=dev_databricks_kv::$(jq -r '.environments.dev.databricks_kv' input-file.json)
          echo ::set-output name=dev_squad_name::$(jq -r '.environments.dev.squad_name' input-file.json)

          echo ::set-output name=test_subscriptionid::$(jq -r '.environments.test.subscriptionid' input-file.json)
          echo ::set-output name=test_resourcegroup::$(jq -r '.environments.test.resourcegroup' input-file.json)
          echo ::set-output name=test_datafactory_name::$(jq -r '.environments.test.datafactory_name' input-file.json)
          echo ::set-output name=test_databricks_kv::$(jq -r '.environments.test.databricks_kv' input-file.json)
          echo ::set-output name=test_squad_name::$(jq -r '.environments.test.squad_name' input-file.json)

          echo ::set-output name=qa_subscriptionid::$(jq -r '.environments.qa.subscriptionid' input-file.json)
          echo ::set-output name=qa_resourcegroup::$(jq -r '.environments.qa.resourcegroup' input-file.json)
          echo ::set-output name=qa_datafactory_name::$(jq -r '.environments.qa.datafactory_name' input-file.json)
          echo ::set-output name=qa_databricks_kv::$(jq -r '.environments.qa.databricks_kv' input-file.json)
          echo ::set-output name=qa_squad_name::$(jq -r '.environments.qa.squad_name' input-file.json)

          echo ::set-output name=prod_subscriptionid::$(jq -r '.environments.prod.subscriptionid' input-file.json)
          echo ::set-output name=prod_resourcegroup::$(jq -r '.environments.prod.resourcegroup' input-file.json)
          echo ::set-output name=prod_datafactory_name::$(jq -r '.environments.prod.datafactory_name' input-file.json)
          echo ::set-output name=prod_databricks_kv::$(jq -r '.environments.prod.databricks_kv' input-file.json)
          echo ::set-output name=prod_squad_name::$(jq -r '.environments.prod.squad_name' input-file.json)